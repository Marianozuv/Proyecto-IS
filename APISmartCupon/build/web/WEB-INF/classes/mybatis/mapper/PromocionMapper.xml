<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="promociones">
    
    <insert id="registrarPromocion" parameterType="modelo.pojo.Promocion">
        INSERT INTO promocion (
        idEmpresa,
        nombrePromocion,
        descripcion,   
        fechaInicioPromocion,
        fechaTerminoPromocion,
        restricciones,
        idTipoPromocion,
        porcentaje_Costo,
        idCategoria,
        cuponesMaximos,
        codigoPromocion
        ) VALUES (
        #{idEmpresa},
        #{nombrePromocion},
        #{descripcion},
        #{fechaInicioPromocion},
        #{fechaTerminoPromocion},
        #{restricciones},
        #{idTipoPromocion},
        #{porcentaje_Costo},
        #{idCategoria},
        #{cuponesMaximos},
        #{codigoPromocion}
        )
    </insert>
    
    <update id="subirImagenPromocion" parameterType = "modelo.pojo.Promocion">
        UPDATE promocion SET imagenPromocion = #{imagenPromocion} WHERE idPromocion = #{idPromocion}
    </update>
    
    <select id="obtenerPromocion" parameterType="int" resultType="modelo.pojo.Promocion">
        SELECT
        idPromocion,
        idEmpresa,
        nombrePromocion,
        descripcion,   
        fechaInicioPromocion,
        fechaTerminoPromocion,
        restricciones,
        idTipoPromocion,
        porcentaje_Costo,
        idCategoria,
        cuponesMaximos,
        codigoPromocion,
        estatus
        FROM promocion
        WHERE idPromocion = #{idPromocion}
    </select>
    
    
    <insert id="asignarSucursalPromocion" parameterType="modelo.pojo.SucursalPromocion">
        INSERT INTO sucursal_promocion 
               (idSucursal, idPromocion) 
        VALUES (#{idSucursal}, #{idPromocion})
    </insert>
    
    
    <select id="sucursalesAsociadas" parameterType="int" resultType="modelo.pojo.Sucursal" >
        SELECT
            s.idSucursal, 
            s.nombreSucursal,
            s.direccion,
            s.codigoPostal,
            s.colonia,
            s.ciudad,
            s.telefono,
            s.latitud,
            s.longitud,
            s.nombreEncargado
        FROM sucursal s
        NATURAL JOIN sucursal_promocion sp
        WHERE idPromocion = #{idPromocion}
    </select>
    
    <select id="obtenerPromocionByIdCategoria" parameterType="int" resultType="modelo.pojo.Promocion">
        SELECT
            p.idPromocion,
            e.nombreComercial,
            p.nombrePromocion,
            p.descripcion,   
            p.fechaInicioPromocion,
            p.fechaTerminoPromocion,
            p.restricciones,
            cp.TipoPoromocion,
            p.porcentaje_Costo,
            cc.categoria,
            cuponesMaximos,
            codigoPromocion,
            estatus
        FROM promocion p 
        NATURAL JOIN empresa e 
        NATURAL JOIN cat_tipopromocion cp
        NATURAL JOIN cat_categoria cc
        WHERE idCategoria  = #{idCategoria}
    </select>
    
    <update id="editarPromocion" parameterType="modelo.pojo.Promocion">
        UPDATE promocion
        SET
        idEmpresa = #{idEmpresa},
        nombrePromocion = #{nombrePromocion},
        descripcion = #{descripcion},
        fechaInicioPromocion = #{fechaInicioPromocion},
        fechaTerminoPromocion = #{fechaTerminoPromocion},
        restricciones = #{restricciones},
        idTipoPromocion = #{idTipoPromocion},
        porcentaje_Costo = #{porcentaje_Costo},
        idCategoria = #{idCategoria},
        cuponesMaximos = #{cuponesMaximos},
        codigoPromocion = #{codigoPromocion},
        estatus = #{estatus}
        WHERE idPromocion = #{idPromocion}
    </update>
    
    <delete id="eliminarPromocion" parameterType="int">
        DELETE FROM promocion WHERE idPromocion = #{idPromocion}
    </delete>

    <select id="obtenerImagenPromocion" parameterType="int" resultType="modelo.pojo.Promocion">
        SELECT idPromocion, nombrePromocion, TO_BASE64(imagenPromocion) AS 'imagenPromocionBase64' FROM promocion WHERE idPromocion = #{idPromocion}
    </select>
</mapper>



